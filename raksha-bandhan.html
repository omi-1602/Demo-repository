<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Happy Raksha Bandhan, Bidisha!</title>
  <style>
    :root {
      --bg1: #fff8e1;
      --bg2: #ffe0b2;
      --primary: #c62828; /* deep red */
      --accent: #ff8f00;  /* marigold */
      --purple: #6a1b9a;
      --text: #4a2c2a;
      --skin: #f1c27d;
      --skin-dark: #dba15b;
      --shadow: rgba(0,0,0,0.18);
      --white: #ffffff;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background: radial-gradient(1200px 800px at 70% 20%, var(--bg2), var(--bg1));
      overflow: hidden;
    }

    /* Top controls */
    .controls {
      position: fixed;
      top: 12px;
      right: 12px;
      display: flex;
      gap: 10px;
      z-index: 30;
    }

    .btn {
      appearance: none;
      border: none;
      padding: 10px 14px;
      border-radius: 999px;
      background: linear-gradient(180deg, var(--accent), #ffb300);
      color: var(--white);
      font-weight: 700;
      letter-spacing: 0.3px;
      cursor: pointer;
      box-shadow: 0 6px 16px var(--shadow);
      transition: transform 0.15s ease, box-shadow 0.2s ease;
    }
    .btn.secondary { background: linear-gradient(180deg, var(--purple), #8e24aa); }
    .btn:active { transform: translateY(1px) scale(0.99); box-shadow: 0 4px 10px var(--shadow); }

    /* Intro overlay */
    #intro {
      position: fixed; inset: 0;
      background:
        radial-gradient(1200px 800px at 30% 20%, rgba(255, 143, 0, 0.1), transparent 60%),
        radial-gradient(800px 600px at 80% 60%, rgba(198, 40, 40, 0.10), transparent 60%),
        var(--bg1);
      display: grid; place-items: center;
      z-index: 40;
      transition: opacity 400ms ease, visibility 400ms step-end;
    }
    #intro.hidden { opacity: 0; visibility: hidden; }

    .intro-card {
      text-align: center;
      background: var(--white);
      padding: 28px 24px;
      border-radius: 20px;
      box-shadow: 0 12px 28px var(--shadow);
      border: 3px dashed var(--accent);
      max-width: 520px;
      margin: 0 16px;
      animation: pop 600ms ease;
    }
    @keyframes pop { from { transform: scale(0.96); opacity: 0 } to { transform: scale(1); opacity: 1 } }

    .title {
      font-size: 1.8rem;
      color: var(--primary);
      margin: 0 0 8px;
    }
    .subtitle { margin: 0 0 18px; opacity: 0.85; }

    .tap {
      display: inline-flex; align-items: center; gap: 10px;
      font-weight: 700; color: var(--white);
      background: linear-gradient(180deg, var(--primary), #8b1d1d);
      padding: 12px 18px; border-radius: 999px; cursor: pointer;
      box-shadow: 0 10px 22px var(--shadow);
    }

    /* Floating rakhis in the background */
    .float-layer { position: fixed; inset: 0; pointer-events: none; z-index: 5; overflow: hidden; }
    .floating-rakhi {
      position: absolute;
      width: 90px; height: 90px;
      filter: drop-shadow(0 10px 16px rgba(0,0,0,0.12));
      animation: drift 16s ease-in-out infinite, bob 3.8s ease-in-out infinite;
      opacity: 0.9;
    }

    @keyframes drift {
      0%, 100% { transform: translateX(0); }
      50% { transform: translateX(30px); }
    }
    @keyframes bob {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-18px); }
    }

    .floating-rakhi .center {
      position: absolute; inset: 0; margin: auto;
      width: 54px; height: 54px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffd54f, #ff8f00 60%, #c62828 70%);
      border: 4px solid #8e24aa;
    }
    .floating-rakhi .petals {
      position: absolute; inset: 0; margin: auto; width: 78px; height: 78px;
      border-radius: 50%;
      box-shadow:
        0 -34px 0 -26px #ffcc80,
        0 34px 0 -26px #ffcc80,
        34px 0 0 -26px #ffcc80,
        -34px 0 0 -26px #ffcc80,
        24px 24px 0 -26px #ffcc80,
        -24px -24px 0 -26px #ffcc80,
        24px -24px 0 -26px #ffcc80,
        -24px 24px 0 -26px #ffcc80;
    }
    .floating-rakhi::before,
    .floating-rakhi::after {
      content: "";
      position: absolute; top: 45px; width: 80px; height: 4px; background: repeating-linear-gradient(90deg, #c62828 0 8px, #ff8f00 8px 16px);
    }
    .floating-rakhi::before { right: 100%; }
    .floating-rakhi::after { left: 100%; }

    /* Main scene */
    .scene {
      position: relative;
      width: 100%; height: 100vh;
      display: grid; place-items: center;
      z-index: 10;
    }
    .stage {
      position: relative;
      width: min(92vw, 900px);
      height: min(70vh, 520px);
      border-radius: 26px;
      background: linear-gradient(145deg, rgba(255,255,255,0.9), rgba(255,248,225,0.9));
      box-shadow: 0 18px 42px var(--shadow);
      border: 2px solid #ffd59b;
      overflow: hidden;
      display: grid; place-items: center;
      padding: 24px;
    }

    /* Wrist */
    .wrist {
      position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%);
      width: 520px; height: 120px; border-radius: 60px;
      background: linear-gradient(180deg, var(--skin), var(--skin-dark));
      box-shadow: inset 0 10px 24px rgba(0,0,0,0.12), 0 8px 18px rgba(0,0,0,0.08);
      z-index: 3;
    }

    /* Rakhi to tie */
    .rakhi-main {
      position: absolute;
      left: calc(50% - 220px);
      top: calc(50% - 45px);
      width: 90px; height: 90px;
      z-index: 4;
      transition: transform 900ms cubic-bezier(.2,.9,.2,1.2);
    }
    .rakhi-main .decor { position: absolute; inset: 0; }
    .rakhi-main .decor .petals { width: 120px; height: 120px; left: -15px; top: -15px; opacity: 0.9; }
    .rakhi-main .decor .center { width: 80px; height: 80px; border: 6px solid #8e24aa; }

    .strap {
      position: absolute; top: 50%; transform: translateY(-50%);
      height: 10px; width: 0;
      background: repeating-linear-gradient(90deg, #c62828 0 16px, #ff8f00 16px 28px, #c62828 28px 44px);
      border-radius: 5px;
      z-index: 2;
      transition: width 900ms ease-in-out 300ms;
      box-shadow: 0 3px 6px rgba(0,0,0,0.12);
    }
    .strap.left { right: calc(50% + 45px); transform-origin: right center; border-top-right-radius: 0; border-bottom-right-radius: 0; }
    .strap.right { left: calc(50% + 45px); transform-origin: left center; border-top-left-radius: 0; border-bottom-left-radius: 0; }

    /* Tie button */
    .actions { position: absolute; bottom: 18px; display: flex; gap: 10px; z-index: 5; }

    /* Wish */
    .wish {
      position: absolute; inset: 0;
      display: grid; place-items: center; text-align: center;
      padding: 24px;
      pointer-events: none;
    }
    .wish .card {
      background: rgba(255,255,255,0.92);
      border: 2px dashed var(--purple);
      border-radius: 16px;
      padding: 16px 18px;
      box-shadow: 0 10px 22px var(--shadow);
      transform: translateY(10px);
      opacity: 0;
      transition: 600ms ease;
      max-width: 700px;
    }

    .scene.tied .rakhi-main { transform: translateX(220px) scale(1.02) rotate(2deg); }
    .scene.tied .strap.left { width: 240px; }
    .scene.tied .strap.right { width: 240px; }
    .scene.tied .wish .card { opacity: 1; transform: translateY(0); transition-delay: 800ms; }

    /* Confetti */
    .confetti {
      position: absolute;
      width: 10px; height: 14px;
      border-radius: 2px;
      opacity: 0.9;
      animation: fall 2200ms ease-in forwards;
    }
    @keyframes fall { from { transform: translateY(-20px) rotate(0deg) } to { transform: translateY(240px) rotate(420deg); opacity: 0 } }

    /* Hints */
    .hint { position: absolute; top: 16px; left: 16px; font-weight: 600; opacity: 0.75; }

    /* Responsive tweaks */
    @media (max-width: 700px) {
      .wrist { width: 86vw; height: 96px; border-radius: 48px; }
      .rakhi-main { left: calc(50% - 170px); top: calc(50% - 42px); }
      .scene.tied .rakhi-main { transform: translateX(170px) scale(1.02) rotate(2deg); }
      .scene.tied .strap.left, .scene.tied .strap.right { width: 180px; }
    }
  </style>
</head>
<body>
  <div class="controls">
    <button id="musicBtn" class="btn secondary" aria-pressed="false" title="Toggle music">♪ Music</button>
  </div>

  <div id="intro">
    <div class="intro-card">
      <h1 class="title">Happy Raksha Bandhan, Bidisha! ✨</h1>
      <p class="subtitle">A little interactive surprise just for you. Ready to tie your rakhi?</p>
      <div id="startBtn" class="tap">Click to start</div>
    </div>
  </div>

  <div class="float-layer" aria-hidden="true">
    <div class="floating-rakhi" style="left: 6%; top: 20%; animation-delay: 0s, .2s"></div>
    <div class="floating-rakhi" style="left: 78%; top: 18%; animation-delay: .8s, 1.2s"></div>
    <div class="floating-rakhi" style="left: 12%; top: 68%; animation-delay: 1.4s, .6s"></div>
    <div class="floating-rakhi" style="left: 84%; top: 70%; animation-delay: .2s, .9s"></div>
    <div class="floating-rakhi" style="left: 32%; top: 8%; animation-delay: 1.1s, .4s"></div>
    <div class="floating-rakhi" style="left: 58%; top: 84%; animation-delay: .5s, 1.4s"></div>
    <!-- Visual structure inside each floating rakhi -->
    <template id="rakhiTemplate">
      <div class="petals"></div>
      <div class="center"></div>
    </template>
  </div>

  <main class="scene" id="scene">
    <div class="stage">
      <div class="hint">Tap the button below to tie the rakhi 🎀</div>
      <div class="wrist" aria-label="Wrist to tie the rakhi on"></div>

      <!-- Straps that will animate to wrap around the wrist -->
      <div class="strap left"></div>
      <div class="strap right"></div>

      <!-- Main rakhi element that will move onto the wrist -->
      <div class="rakhi-main" id="rakhi">
        <div class="decor">
          <div class="petals"></div>
          <div class="center"></div>
        </div>
      </div>

      <div class="actions">
        <button id="tieBtn" class="btn">Tie the Rakhi</button>
      </div>

      <div class="wish" aria-live="polite">
        <div class="card">
          <h2 style="margin: 6px 0 6px; color: var(--primary);">Happy Raksha Bandhan, Didi Bidisha! 💖</h2>
          <p style="margin: 6px 0 0; font-size: 1.05rem;">
            May your days be filled with joy, strength, and endless laughter. Thank you for all the love and guidance. 
            Today and always, your little one is tying this rakhi with lots of love and smiles! 🌼
          </p>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Populate inner visuals for floating rakhis
    (function buildFloatingRakhis(){
      const template = document.getElementById('rakhiTemplate');
      document.querySelectorAll('.floating-rakhi').forEach(el => {
        el.innerHTML = template.innerHTML;
      });
    })();

    const intro = document.getElementById('intro');
    const startBtn = document.getElementById('startBtn');
    const scene = document.getElementById('scene');
    const tieBtn = document.getElementById('tieBtn');

    let tied = false;

    function launchConfetti(x, y) {
      const colors = ['#ff8f00', '#c62828', '#8e24aa', '#ffd54f', '#26c6da'];
      const container = document.querySelector('.stage');
      for (let i = 0; i < 48; i++) {
        const piece = document.createElement('div');
        piece.className = 'confetti';
        piece.style.left = (x + (Math.random()*80 - 40)) + 'px';
        piece.style.top = (y + (Math.random()*20 - 10)) + 'px';
        piece.style.background = colors[Math.floor(Math.random()*colors.length)];
        piece.style.transform = `translateY(-20px) rotate(${Math.random()*180}deg)`;
        piece.style.animationDuration = (1600 + Math.random()*1200) + 'ms';
        piece.style.opacity = (0.7 + Math.random()*0.3);
        container.appendChild(piece);
        setTimeout(() => piece.remove(), 2400);
      }
    }

    function tieRakhi() {
      if (tied) return;
      tied = true;
      scene.classList.add('tied');
      // approximate center of stage
      const stageRect = document.querySelector('.stage').getBoundingClientRect();
      launchConfetti(stageRect.width/2 - 10, stageRect.height/2 - 40);
    }

    startBtn.addEventListener('click', () => {
      intro.classList.add('hidden');
    }, { once: true });

    tieBtn.addEventListener('click', tieRakhi);

    // Simple background music using Web Audio API
    let audioCtx = null;
    let musicInterval = null;
    let droneOsc = null;
    let musicOn = false;
    const musicBtn = document.getElementById('musicBtn');

    function freq(note) {
      // note like 'C4', 'D4', etc. Base A4=440
      const A4 = 440;
      const noteIndex = { C: -9, Cs: -8, Db: -8, D: -7, Ds: -6, Eb: -6, E: -5, F: -4, Fs: -3, Gb: -3, G: -2, Gs: -1, Ab: -1, A: 0, As: 1, Bb: 1, B: 2 };
      return function(n){
        const m = n.match(/^([A-G](?:b|s)?)(\d)$/);
        if(!m) return 440;
        const semi = noteIndex[m[1]] + (parseInt(m[2],10) - 4) * 12;
        return A4 * Math.pow(2, semi/12);
      }(note);
    }

    const pentatonic = [freq('C4'), freq('D4'), freq('E4'), freq('G4'), freq('A4'), freq('C5')];

    function playNote(f, durationMs = 400) {
      if (!audioCtx) return;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = 'triangle';
      osc.frequency.value = f;
      gain.gain.value = 0.0001;
      osc.connect(gain).connect(audioCtx.destination);
      const now = audioCtx.currentTime;
      // simple pluck envelope
      gain.gain.exponentialRampToValueAtTime(0.12, now + 0.02);
      gain.gain.exponentialRampToValueAtTime(0.001, now + durationMs/1000);
      osc.start();
      osc.stop(now + durationMs/1000 + 0.05);
    }

    function startMusic() {
      if (musicOn) return;
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      // Drone (tanpura-like simple sine) on low C
      droneOsc = audioCtx.createOscillator();
      const droneGain = audioCtx.createGain();
      droneOsc.type = 'sine';
      droneOsc.frequency.value = freq('C3');
      droneGain.gain.value = 0.02;
      droneOsc.connect(droneGain).connect(audioCtx.destination);
      droneOsc.start();

      let step = 0;
      musicInterval = setInterval(() => {
        const f = pentatonic[step % pentatonic.length] * (Math.random() < 0.15 ? 2 : 1);
        playNote(f, 420);
        step++;
      }, 520);

      musicOn = true;
      musicBtn.setAttribute('aria-pressed', 'true');
      musicBtn.textContent = '⏸ Music';
    }

    function stopMusic() {
      if (!musicOn) return;
      clearInterval(musicInterval); musicInterval = null;
      if (droneOsc) {
        try { droneOsc.stop(); } catch (e) {}
        droneOsc.disconnect();
        droneOsc = null;
      }
      musicOn = false;
      musicBtn.setAttribute('aria-pressed', 'false');
      musicBtn.textContent = '♪ Music';
    }

    musicBtn.addEventListener('click', async () => {
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === 'suspended') await audioCtx.resume();
      if (musicOn) stopMusic(); else startMusic();
    });

    // Accessibility: Space/Enter to activate big buttons
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !tied && !intro.classList.contains('hidden')) {
        startBtn.click();
      } else if ((e.key === 'Enter' || e.key === ' ') && !tied && intro.classList.contains('hidden')) {
        e.preventDefault();
        tieBtn.click();
      }
    });
  </script>
</body>
</html>